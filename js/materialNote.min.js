!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){Array.prototype.reduce||(Array.prototype.reduce=function(a){var b,c=Object(this),d=c.length>>>0,e=0;if(2===arguments.length)b=arguments[1];else{for(;e<d&&!(e in c);)e++;if(e>=d)throw new TypeError("Reduce of empty array with no initial value");b=c[e++]}for(;e<d;e++)e in c&&(b=a(b,c[e],e,c));return b}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(a){for(var b=Object(this),c=b.length>>>0,d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;f<c;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d});var b="function"==typeof define&&define.amd,c=function(b){if("Roboto"===b)return!0;var c="Comic Sans MS"===b?"Courier New":"Comic Sans MS",d=a("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),e=d.css("fontFamily",c).width(),f=d.css("fontFamily",b+","+c).width();return d.remove(),e!==f},d=!!window.CodeMirror;if(!d&&b&&require)if(require.hasOwnProperty("resolve"))try{require.resolve("CodeMirror"),d=!0}catch(e){d=!1}else require.hasOwnProperty("specified")&&(d=require.specified("CodeMirror"));var f,g=navigator.userAgent,h={isMac:navigator.appVersion.indexOf("Mac")>-1,isMSIE:/MSIE|Trident/i.test(g),isFF:/firefox/i.test(g),isWebkit:/webkit/i.test(g),isSafari:/safari/i.test(g),jqueryVersion:parseFloat(a.fn.jquery),isSupportAmd:b,hasCodeMirror:d,isFontInstalled:c,isW3CRangeSupport:!!document.createRange},i=function(){var b=function(a){return function(b){return a===b}},c=function(a,b){return a===b},d=function(a){return function(b,c){return b[a]===c[a]}},e=function(){return!0},f=function(){return!1},g=function(a){return function(){return!a.apply(a,arguments)}},h=function(a,b){return function(c){return a(c)&&b(c)}},i=function(a){return a},j=0,k=function(a){var b=++j+"";return a?a+b:b},l=function(b){var c=a(document);return{top:b.top+c.scrollTop(),left:b.left+c.scrollLeft(),width:b.right-b.left,height:b.bottom-b.top}},m=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b},n=function(a,b){return b=b||"",b+a.split(".").map(function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}).join("")};return{eq:b,eq2:c,peq2:d,ok:e,fail:f,self:i,not:g,and:h,uniqueId:k,rect2bnd:l,invertObject:m,namespaceToCamel:n}}(),j=function(){var b=function(a){return a[0]},c=function(a){return a[a.length-1]},d=function(a){return a.slice(0,a.length-1)},e=function(a){return a.slice(1)},f=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(b(e))return e}},g=function(a,b){for(var c=0,d=a.length;c<d;c++)if(!b(a[c]))return!1;return!0},h=function(b,c){return a.inArray(c,b)!==-1},j=function(a,b){return b=b||i.self,a.reduce(function(a,c){return a+b(c)},0)},k=function(a){for(var b=[],c=-1,d=a.length;++c<d;)b[c]=a[c];return b},l=function(a,d){if(!a.length)return[];var f=e(a);return f.reduce(function(a,b){var e=c(a);return d(c(e),b)?e[e.length]=b:a[a.length]=[b],a},[[b(a)]])},m=function(a){for(var b=[],c=0,d=a.length;c<d;c++)a[c]&&b.push(a[c]);return b},n=function(a){for(var b=[],c=0,d=a.length;c<d;c++)h(b,a[c])||b.push(a[c]);return b},o=function(a,b){var c=a.indexOf(b);return c===-1?null:a[c+1]},p=function(a,b){var c=a.indexOf(b);return c===-1?null:a[c-1]};return{head:b,last:c,initial:d,tail:e,prev:p,next:o,find:f,contains:h,all:g,sum:j,from:k,clusterBy:l,compact:m,unique:n}}(),k=String.fromCharCode(160),l="\ufeff",m=function(){var b=function(b){return b&&a(b).hasClass("note-editable")},c=function(b){return b&&a(b).hasClass("note-control-sizing")},d=function(b){var c;if(b.hasClass("note-air-editor")){var d=j.last(b.attr("id").split("-"));return c=function(b){return function(){return a(b+d)}},{editor:function(){return b},holder:function(){return b.data("holder")},editable:function(){return b},popover:c("#note-popover-"),handle:c("#note-handle-"),dialog:c("#note-dialog-")}}return c=function(a){return function(){return b.find(a)}},{editor:function(){return b},holder:function(){return b.data("holder")},dropzone:c(".note-dropzone"),toolbar:c(".note-toolbar"),editable:c(".note-editable"),codable:c(".note-codable"),statusbar:c(".note-statusbar"),popover:c(".note-popover"),handle:c(".note-handle"),dialog:c(".note-dialog")}},e=function(b){var c=a(b).closest(".note-editor, .note-air-editor, .note-air-layout");if(!c.length)return null;var e;return e=c.is(".note-editor, .note-air-editor")?c:a("#note-editor-"+j.last(c.attr("id").split("-"))),d(e)},f=function(a){return a=a.toUpperCase(),function(b){return b&&b.nodeName.toUpperCase()===a}},g=function(a){return a&&3===a.nodeType},n=function(a){return a&&/^BR|^IMG|^HR/.test(a.nodeName.toUpperCase())},o=function(a){return!b(a)&&(a&&/^DIV|^P|^LI|^H[1-7]/.test(a.nodeName.toUpperCase()))},p=f("LI"),q=function(a){return o(a)&&!p(a)},r=f("TABLE"),s=function(a){return!(w(a)||t(a)||o(a)||r(a)||v(a))},t=function(a){return a&&/^UL|^OL/.test(a.nodeName.toUpperCase())},u=function(a){return a&&/^TD|^TH/.test(a.nodeName.toUpperCase())},v=f("BLOCKQUOTE"),w=function(a){return u(a)||v(a)||b(a)},x=f("A"),y=function(a){return s(a)&&!!H(a,o)},z=function(a){return s(a)&&!H(a,o)},A=f("BODY"),B=function(a,b){return a.nextSibling===b||a.previousSibling===b},C=function(a,b){b=b||i.ok;var c=[];return a.previousSibling&&b(a.previousSibling)&&c.push(a.previousSibling),c.push(a),a.nextSibling&&b(a.nextSibling)&&c.push(a.nextSibling),c},D=h.isMSIE?"&nbsp;":"<br>",E=function(a){return g(a)?a.nodeValue.length:a.childNodes.length},F=function(a){var b=E(a);return 0===b||(!g(a)&&1===b&&a.innerHTML===D||!(!j.all(a.childNodes,g)||""!==a.innerHTML))},G=function(a){n(a)||E(a)||(a.innerHTML=D)},H=function(a,c){for(;a;){if(c(a))return a;if(b(a))break;a=a.parentNode}return null},I=function(a,c){for(a=a.parentNode;a&&1===E(a);){if(c(a))return a;if(b(a))break;a=a.parentNode}return null},J=function(a,c){c=c||i.fail;var d=[];return H(a,function(a){return b(a)||d.push(a),c(a)}),d},K=function(a,b){var c=J(a);return j.last(c.filter(b))},L=function(b,c){for(var d=J(b),e=c;e;e=e.parentNode)if(a.inArray(e,d)>-1)return e;return null},M=function(a,b){b=b||i.fail;for(var c=[];a&&!b(a);)c.push(a),a=a.previousSibling;return c},N=function(a,b){b=b||i.fail;for(var c=[];a&&!b(a);)c.push(a),a=a.nextSibling;return c},O=function(a,b){var c=[];return b=b||i.ok,function d(e){a!==e&&b(e)&&c.push(e);for(var f=0,g=e.childNodes.length;f<g;f++)d(e.childNodes[f])}(a),c},P=function(b,c){var d=b.parentNode,e=a("<"+c+">")[0];return d.insertBefore(e,b),e.appendChild(b),e},Q=function(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a},R=function(b,c){return a.each(c,function(a,c){b.appendChild(c)}),b},S=function(a){return 0===a.offset},T=function(a){return a.offset===E(a.node)},U=function(a){return S(a)||T(a)},V=function(a,b){for(;a&&a!==b;){if(0!==X(a))return!1;a=a.parentNode}return!0},W=function(a,b){for(;a&&a!==b;){if(X(a)!==E(a.parentNode)-1)return!1;a=a.parentNode}return!0},X=function(a){for(var b=0;a=a.previousSibling;)b+=1;return b},Y=function(a){return!!(a&&a.childNodes&&a.childNodes.length)},Z=function(a,c){var d,e;if(0===a.offset){if(b(a.node))return null;d=a.node.parentNode,e=X(a.node)}else Y(a.node)?(d=a.node.childNodes[a.offset-1],e=E(d)):(d=a.node,e=c?0:a.offset-1);return{node:d,offset:e}},$=function(a,c){var d,e;if(E(a.node)===a.offset){if(b(a.node))return null;d=a.node.parentNode,e=X(a.node)+1}else Y(a.node)?(d=a.node.childNodes[a.offset],e=0):(d=a.node,e=c?E(a.node):a.offset+1);return{node:d,offset:e}},_=function(a,b){return a.node===b.node&&a.offset===b.offset},aa=function(a){if(g(a.node)||!Y(a.node)||F(a.node))return!0;var b=a.node.childNodes[a.offset-1],c=a.node.childNodes[a.offset];return!(b&&!n(b)||c&&!n(c))},ba=function(a,b){for(;a;){if(b(a))return a;a=Z(a)}return null},ca=function(a,b){for(;a;){if(b(a))return a;a=$(a)}return null},da=function(a){if(!g(a.node))return!1;var b=a.node.nodeValue.charAt(a.offset-1);return b&&" "!==b&&b!==k},ea=function(a,b,c,d){for(var e=a;e&&(c(e),!_(e,b));){var f=d&&a.node!==e.node&&b.node!==e.node;e=$(e,f)}},fa=function(b,c){var d=J(c,i.eq(b));return a.map(d,X).reverse()},ga=function(a,b){for(var c=a,d=0,e=b.length;d<e;d++)c=c.childNodes.length<=b[d]?c.childNodes[c.childNodes.length-1]:c.childNodes[b[d]];return c},ha=function(a,b){var c=b&&b.isSkipPaddingBlankHTML,d=b&&b.isNotSplitEdgePoint;if(U(a)&&(g(a.node)||d)){if(S(a))return a.node;if(T(a))return a.node.nextSibling}if(g(a.node))return a.node.splitText(a.offset);var e=a.node.childNodes[a.offset],f=Q(a.node.cloneNode(!1),a.node);return R(f,N(e)),c||(G(a.node),G(f)),f},ia=function(a,b,c){var d=J(b.node,i.eq(a));return d.length?1===d.length?ha(b,c):d.reduce(function(a,d){return a===b.node&&(a=ha(b,c)),ha({node:d,offset:a?m.position(a):E(d)},c)}):null},ja=function(a,b){var c,d,e=b?o:w,f=J(a.node,e),g=j.last(f)||a.node;e(g)?(c=f[f.length-2],d=g):(c=g,d=c.parentNode);var h=c&&ia(c,a,{isSkipPaddingBlankHTML:b,isNotSplitEdgePoint:b});return h||d!==a.node||(h=a.node.childNodes[a.offset]),{rightNode:h,container:d}},ka=function(a){return document.createElement(a)},la=function(a){return document.createTextNode(a)},ma=function(a,b){if(a&&a.parentNode){if(a.removeNode)return a.removeNode(b);var c=a.parentNode;if(!b){var d,e,f=[];for(d=0,e=a.childNodes.length;d<e;d++)f.push(a.childNodes[d]);for(d=0,e=f.length;d<e;d++)c.insertBefore(f[d],a)}c.removeChild(a)}},na=function(a,c){for(;a&&!b(a)&&c(a);){var d=a.parentNode;ma(a),a=d}},oa=function(a,b){if(a.nodeName.toUpperCase()===b.toUpperCase())return a;var c=ka(b);return a.style.cssText&&(c.style.cssText=a.style.cssText),R(c,j.from(a.childNodes)),Q(c,a),ma(a),c},pa=f("TEXTAREA"),qa=function(a,b){var c=pa(a[0])?a.val():a.html();return b?c.replace(/[\n\r]/g,""):c},ra=function(b,c){var d=qa(b);if(c){var e=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;d=d.replace(e,function(a,b,c){c=c.toUpperCase();var d=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(c)&&!!b,e=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(c);return a+(d||e?"\n":"")}),d=a.trim(d)}return d};return{NBSP_CHAR:k,ZERO_WIDTH_NBSP_CHAR:l,blank:D,emptyPara:"<p>"+D+"</p>",makePredByNodeName:f,isEditable:b,isControlSizing:c,buildLayoutInfo:d,makeLayoutInfo:e,isText:g,isVoid:n,isPara:o,isPurePara:q,isInline:s,isBlock:i.not(s),isBodyInline:z,isBody:A,isParaInline:y,isList:t,isTable:r,isCell:u,isBlockquote:v,isBodyContainer:w,isAnchor:x,isDiv:f("DIV"),isLi:p,isBR:f("BR"),isSpan:f("SPAN"),isB:f("B"),isU:f("U"),isS:f("S"),isI:f("I"),isImg:f("IMG"),isTextarea:pa,isEmpty:F,isEmptyAnchor:i.and(x,F),isClosestSibling:B,withClosestSiblings:C,nodeLength:E,isLeftEdgePoint:S,isRightEdgePoint:T,isEdgePoint:U,isLeftEdgeOf:V,isRightEdgeOf:W,prevPoint:Z,nextPoint:$,isSamePoint:_,isVisiblePoint:aa,prevPointUntil:ba,nextPointUntil:ca,isCharPoint:da,walkPoint:ea,ancestor:H,singleChildAncestor:I,listAncestor:J,lastAncestor:K,listNext:N,listPrev:M,listDescendant:O,commonAncestor:L,wrap:P,insertAfter:Q,appendChildNodes:R,position:X,hasChildren:Y,makeOffsetPath:fa,fromOffsetPath:ga,splitTree:ia,splitPoint:ja,create:ka,createText:la,remove:ma,removeWhile:na,replace:oa,html:ra,value:qa}}(),n=function(){var b=function(a,b){var c,d,e=a.parentElement(),f=document.body.createTextRange(),g=j.from(e.childNodes);for(c=0;c<g.length;c++)if(!m.isText(g[c])){if(f.moveToElementText(g[c]),f.compareEndPoints("StartToStart",a)>=0)break;d=g[c]}if(0!==c&&m.isText(g[c-1])){var h=document.body.createTextRange(),i=null;h.moveToElementText(d||e),h.collapse(!d),i=d?d.nextSibling:e.firstChild;var k=a.duplicate();k.setEndPoint("StartToStart",h);for(var l=k.text.replace(/[\r\n]/g,"").length;l>i.nodeValue.length&&i.nextSibling;)l-=i.nodeValue.length,i=i.nextSibling;i.nodeValue;b&&i.nextSibling&&m.isText(i.nextSibling)&&l===i.nodeValue.length&&(l-=i.nodeValue.length,i=i.nextSibling),e=i,c=l}return{cont:e,offset:c}},c=function(a){var b=function(a,c){var d,e;if(m.isText(a)){var f=m.listPrev(a,i.not(m.isText)),g=j.last(f).previousSibling;d=g||a.parentNode,c+=j.sum(j.tail(f),m.nodeLength),e=!g}else{if(d=a.childNodes[c]||a,m.isText(d))return b(d,0);c=0,e=!1}return{node:d,collapseToStart:e,offset:c}},c=document.body.createTextRange(),d=b(a.node,a.offset);return c.moveToElementText(d.node),c.collapse(d.collapseToStart),c.moveStart("character",d.offset),c},d=function(b,e,f,g){this.sc=b,this.so=e,this.ec=f,this.eo=g;var k=function(){if(h.isW3CRangeSupport){var a=document.createRange();return a.setStart(b,e),a.setEnd(f,g),a}var d=c({node:b,offset:e});return d.setEndPoint("EndToEnd",c({node:f,offset:g})),d};this.getPoints=function(){return{sc:b,so:e,ec:f,eo:g}},this.getStartPoint=function(){return{node:b,offset:e}},this.getEndPoint=function(){return{node:f,offset:g}},this.select=function(){var a=k();if(h.isW3CRangeSupport){var b=document.getSelection();b.rangeCount>0&&b.removeAllRanges(),b.addRange(a)}else a.select();return this},this.normalize=function(){var a=function(a){return m.isVisiblePoint(a)||(a=m.isLeftEdgePoint(a)?m.nextPointUntil(a,m.isVisiblePoint):m.prevPointUntil(a,m.isVisiblePoint)),a},b=a(this.getStartPoint()),c=a(this.getEndPoint());return new d(b.node,b.offset,c.node,c.offset)},this.nodes=function(a,b){a=a||i.ok;var c=b&&b.includeAncestor,d=b&&b.fullyContains,e=this.getStartPoint(),f=this.getEndPoint(),g=[],h=[];return m.walkPoint(e,f,function(b){if(!m.isEditable(b.node)){var e;d?(m.isLeftEdgePoint(b)&&h.push(b.node),m.isRightEdgePoint(b)&&j.contains(h,b.node)&&(e=b.node)):e=c?m.ancestor(b.node,a):b.node,e&&a(e)&&g.push(e)}},!0),j.unique(g)},this.commonAncestor=function(){return m.commonAncestor(b,f)},this.expand=function(a){var c=m.ancestor(b,a),h=m.ancestor(f,a);if(!c&&!h)return new d(b,e,f,g);var i=this.getPoints();return c&&(i.sc=c,i.so=0),h&&(i.ec=h,i.eo=m.nodeLength(h)),new d(i.sc,i.so,i.ec,i.eo)},this.collapse=function(a){return a?new d(b,e,b,e):new d(f,g,f,g)},this.splitText=function(){var a=b===f,c=this.getPoints();return m.isText(f)&&!m.isEdgePoint(this.getEndPoint())&&f.splitText(g),m.isText(b)&&!m.isEdgePoint(this.getStartPoint())&&(c.sc=b.splitText(e),c.so=0,a&&(c.ec=c.sc,c.eo=g-e)),new d(c.sc,c.so,c.ec,c.eo)},this.deleteContents=function(){if(this.isCollapsed())return this;var b=this.splitText(),c=b.nodes(null,{fullyContains:!0}),e=m.prevPointUntil(b.getStartPoint(),function(a){return!j.contains(c,a.node)}),f=[];return a.each(c,function(a,b){var c=b.parentNode;e.node!==c&&1===m.nodeLength(c)&&f.push(c),m.remove(b,!1)}),a.each(f,function(a,b){m.remove(b,!1)}),new d(e.node,e.offset,e.node,e.offset).normalize()};var l=function(a){return function(){var c=m.ancestor(b,a);return!!c&&c===m.ancestor(f,a)}};this.isOnEditable=l(m.isEditable),this.isOnList=l(m.isList),this.isOnAnchor=l(m.isAnchor),this.isOnCell=l(m.isCell),this.isLeftEdgeOf=function(a){if(!m.isLeftEdgePoint(this.getStartPoint()))return!1;var b=m.ancestor(this.sc,a);return b&&m.isLeftEdgeOf(this.sc,b)},this.isCollapsed=function(){return b===f&&e===g},this.wrapBodyInlineWithPara=function(){if(m.isBodyContainer(b)&&m.isEmpty(b))return b.innerHTML=m.emptyPara,new d(b.firstChild,0,b.firstChild,0);if(m.isParaInline(b)||m.isPara(b))return this.normalize();var a;if(m.isInline(b)){var c=m.listAncestor(b,i.not(m.isInline));a=j.last(c),m.isInline(a)||(a=c[c.length-2]||b.childNodes[e])}else a=b.childNodes[e>0?e-1:0];var f=m.listPrev(a,m.isParaInline).reverse();if(f=f.concat(m.listNext(a.nextSibling,m.isParaInline)),f.length){var g=m.wrap(j.head(f),"p");m.appendChildNodes(g,j.tail(f))}return this.normalize()},this.insertNode=function(a){var b=this.wrapBodyInlineWithPara().deleteContents(),c=m.splitPoint(b.getStartPoint(),m.isInline(a));return c.rightNode?c.rightNode.parentNode.insertBefore(a,c.rightNode):c.container.appendChild(a),a},this.pasteHTML=function(b){var c=this,d=a("<div></div>").html(b)[0],e=j.from(d.childNodes);return this.wrapBodyInlineWithPara().deleteContents(),a.map(e.reverse(),function(a){return c.insertNode(a)}).reverse()},this.toString=function(){var a=k();return h.isW3CRangeSupport?a.toString():a.text},this.getWordRange=function(a){var b=this.getEndPoint();if(!m.isCharPoint(b))return this;var c=m.prevPointUntil(b,function(a){return!m.isCharPoint(a)});return a&&(b=m.nextPointUntil(b,function(a){return!m.isCharPoint(a)})),new d(c.node,c.offset,b.node,b.offset)},this.bookmark=function(a){return{s:{path:m.makeOffsetPath(a,b),offset:e},e:{path:m.makeOffsetPath(a,f),offset:g}}},this.paraBookmark=function(a){return{s:{path:j.tail(m.makeOffsetPath(j.head(a),b)),offset:e},e:{path:j.tail(m.makeOffsetPath(j.last(a),f)),offset:g}}},this.getClientRects=function(){var a=k();return a.getClientRects()}};return{create:function(a,c,e,f){if(arguments.length)2===arguments.length&&(e=a,f=c);else if(h.isW3CRangeSupport){var g=document.getSelection();if(!g||0===g.rangeCount)return null;if(m.isBody(g.anchorNode))return null;var i=g.getRangeAt(0);a=i.startContainer,c=i.startOffset,e=i.endContainer,f=i.endOffset}else{var j=document.selection.createRange(),k=j.duplicate();k.collapse(!1);var l=j;l.collapse(!0);var n=b(l,!0),o=b(k,!1);m.isText(n.node)&&m.isLeftEdgePoint(n)&&m.isTextNode(o.node)&&m.isRightEdgePoint(o)&&o.node.nextSibling===n.node&&(n=o),a=n.cont,c=n.offset,e=o.cont,f=o.offset}return new d(a,c,e,f)},createFromNode:function(a){var b=a,c=0,d=a,e=m.nodeLength(d);return m.isVoid(b)&&(c=m.listPrev(b).length-1,b=b.parentNode),m.isBR(d)?(e=m.listPrev(d).length-1,d=d.parentNode):m.isVoid(d)&&(e=m.listPrev(d).length,d=d.parentNode),this.create(b,c,d,e)},createFromNodeBefore:function(a){return this.createFromNode(a).collapse(!0)},createFromNodeAfter:function(a){return this.createFromNode(a).collapse()},createFromBookmark:function(a,b){var c=m.fromOffsetPath(a,b.s.path),e=b.s.offset,f=m.fromOffsetPath(a,b.e.path),g=b.e.offset;return new d(c,e,f,g)},createFromParaBookmark:function(a,b){var c=a.s.offset,e=a.e.offset,f=m.fromOffsetPath(j.head(b),a.s.path),g=m.fromOffsetPath(j.last(b),a.e.path);return new d(f,c,g,e)}}}(),o={version:"0.6.9",options:{defaultTextColor:"#212121",defaultBackColor:"#ddd",followingToolbar:!0,otherStaticBarClass:"staticTop",width:null,height:null,minHeight:null,maxHeight:null,focus:!1,tabsize:4,styleWithSpan:!0,disableLinkTarget:!1,disableDragAndDrop:!1,disableResizeEditor:!1,shortcuts:!0,placeholder:!1,prettifyHtml:!0,iconPrefix:"",icons:{font:{bold:"format_bold",italic:"format_italic",underline:"format_underlined",clear:"clear",height:"format_size",strikethrough:"strikethrough_s",superscript:"vertical_align_top",subscript:"vertical_align_bottom"},image:{image:"image",floatLeft:"format_align_left",floatRight:"format_align_right",floatNone:"format_align_justify",shapeRounded:"crop_3_2",shapeCircle:"panorama_fish_eye",shapeThumbnail:"collections",bordered:"border_outer",shapeNone:"image",remove:"delete"},link:{link:"insert_link",unlink:"clear",edit:"create"},table:{table:"border_all"},hr:{insert:"add"},style:{style:"border_color"},lists:{unordered:"format_list_bulleted",ordered:"format_list_numbered"},options:{help:"help",fullscreen:"settings_overscan",codeview:"code"},paragraph:{paragraph:"format_textdirection_l_to_r",outdent:"format_indent_decrease",indent:"format_indent_increase",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify"},color:{recent:"format_color_text"},history:{undo:"undo",redo:"redo"},misc:{check:"check"}},codemirror:{mode:"text/html",htmlMode:!0,indentWithTabs:!0,tabSize:4,lineNumbers:!0,theme:"monokai",maxHighlightLength:"Infinity"},lang:"en-US",direction:null,toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],plugin:{},airMode:!1,airPopover:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]],styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],defaultFontName:"Roboto",fontNames:["Roboto","Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Helvetica","Impact","Times New Roman","Verdana"],fontNamesIgnoreCheck:[],fontSizes:["12","13","14","15","16","17","18","25","37"],colors:[["#fafafa","#efebe9","#7e57c2","#ab47bc","#5c6bc0","#42a5f5","#26c6da","#66bb6a","#9ccc65","#ffee58","#ffca28","#ffa726","#ff7043","#ef5350","#ec407a"],["#f5f5f5","#d7ccc8","#673ab7","#9c27b0","#3f51b5","#2196f3","#00bcd4","#4caf50","#8bc34a","#ffeb3b","#ffc107","#ff9800","#ff5722","#f44336","#e91e63"],["#eeeeee","#bcaaa4","#5e35b1","#8e24aa","#3949ab","#1e88e5","#00acc1","#43a047","#7cb342","#fdd835","#ffb300","#fb8c00","#f4511e","#e53935","#d81b60"],["#e0e0e0","#a1887f","#512da8","#7b1fa2","#303f9f","#1976d2","#0097a7","#388e3c","#689f38","#fbc02d","#ffa000","#f57c00","#e64a19","#d32f2f","#c2185b"],["#bdbdbd","#8d6e63","#4527a0","#6a1b9a","#283593","#1565c0","#00838f","#2e7d32","#558b2f","#f9a825","#ff8f00","#ef6c00","#d84315","#c62828","#ad1457"],["#9e9e9e","#795548","#311b92","#4a148c","#1a237e","#0d47a1","#006064","#1b5e20","#33691e","#f57f17","#ff6f00","#e65100","#bf360c","#b71c1c","#880e4f"],["#757575","#6d4c41","#b388ff","#ea80fc","#8c9eff","#82b1ff","#84ffff","#b9f6ca","#ccff90","#ffff8d","#ffe57f","#ffd180","#ff9e80","#ff8a80","#ff80ab"],["#616161","#5d4037","#7c4dff","#e040fb","#536dfe","#448aff","#18ffff","#69f0ae","#b2ff59","#ffff00","#ffd740","#ffab40","#ff6e40","#ff5252","#ff4081"],["#424242","#4e342e","#651fff","#d500f9","#3d5afe","#2979ff","#00e5ff","#00e676","#76ff03","#ffea00","#ffc400","#ff9100","#ff3d00","#ff1744","#f50057"],["#212121","#3e2723","#6200ea","#aa00ff","#304ffe","#2962ff","#00b8d4","#00c853","#64dd17","#ffd600","#ffab00","#ff6d00","#dd2c00","#d50000","#c51162"]],colorTitles:[["grey lighten5","brown lighten5","deep-purple lighten1","purple lighten1","indigo lighten1","blue lighten1","cyan lighten1","green lighten1","light-green lighten1","yellow lighten1","amber lighten1","orange lighten1","deep-orange lighten1","red lighten1","pink lighten1"],["grey lighten4","brown lighten4","deep-purple","purple","indigo","blue","cyan","green","light-green","yellow","amber","orange","deep-orange","red","pink"],["grey lighten3","brown lighten3","deep-purple darken1","purple darken1","indigo darken1","blue darken1","cyan darken1","green darken1","light-green darken1","yellow darken1","amber darken1","orange darken1","deep-orange darken1","red darken1","pink darken1"],["grey lighten2","brown lighten2","deep-purple darken2","purple darken2","indigo darken2","blue darken2","cyan darken2","green darken2","light-green darken2","yellow darken2","amber darken2","orange darken2","deep-orange darken2","red darken2","pink darken2"],["grey lighten1","brown lighten1","deep-purple darken3","purple darken3","indigo darken3","blue darken3","cyan darken3","green darken3","light-green darken3","yellow darken3","amber darken3","orange darken3","deep-orange darken3","red darken3","pink darken3"],["grey","brown","deep-purple darken4","purple darken4","indigo darken4","blue darken4","cyan darken4","green darken4","light-green darken4","yellow darken4","amber darken4","orange darken4","deep-orange darken4","red darken4","pink darken4"],["grey darken1","brown darken1","deep-purple accent1","purple accent1","indigo accent1","blue accent1","cyan accent1","green accent1","light-green accent1","yellow accent1","amber accent1","orange accent1","deep-orange accent1","red accent1","pink accent1"],["grey darken2","brown darken2","deep-purple accent2","purple accent2","indigo accent2","blue accent2","cyan accent2","green accent2","light-green accent2","yellow accent2","amber accent2","orange accent2","deep-orange accent2","red accent2","pink accent2"],["grey darken3","brown darken3","deep-purple accent3","purple accent3","indigo accent3","blue accent3","cyan accent3","green accent3","light-green accent3","yellow accent3","amber accent3","orange accent3","deep-orange accent3","red accent3","pink accent3"],["grey darken4","brown darken4","deep-purple accent4","purple accent4","indigo accent4","blue accent4","cyan accent4","green accent4","light-green accent4","yellow accent4","amber accent4","orange accent4","deep-orange accent4","red accent4","pink accent4"]],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],insertTableMaxSize:{col:12,row:10},maximumImageFileSize:null,oninit:null,onfocus:null,onblur:null,onenter:null,onkeyup:null,onkeydown:null,onImageUpload:null,onImageUploadError:null,onMediaDelete:null,onToolbarClick:null,onsubmit:null,onCreateLink:function(a){return a.indexOf("@")!==-1&&a.indexOf(":")===-1&&(a="mailto:"+a),a},keyMap:{pc:{ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"showLinkDialog"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"showLinkDialog"}}},lang:{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",clear:"Remove Font Style",height:"Line Height",name:"Font Family",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",size:"Font Size"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",bordered:"Bordered",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag image or text here",dropImage:"Drop image or Text",selectFromFiles:"Select from files",maximumFileSize:"Maximum file size",maximumFileSizeError:"Maximum file size exceeded.",url:"Image URL",remove:"Remove Image"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Table",striped:"Striped",hoverable:"Hoverable",responsive:"Responsive",bordered:"Bordered"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Back",foreground:"Text",transparent:"Transparent",setTransparent:"Transparent",reset:"Reset",resetToDefault:"Default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style",extraKeys:"Extra keys"},history:{undo:"Undo",redo:"Redo"}}}},p=function(){var b=function(b){return a.Deferred(function(c){a.extend(new FileReader,{onload:function(a){var b=a.target.result;c.resolve(b)},onerror:function(){c.reject(this)}}).readAsDataURL(b)}).promise()},c=function(b,c){return a.Deferred(function(d){var e=a("<img>");e.one("load",function(){e.off("error abort"),d.resolve(e)}).one("error abort",function(){e.off("load").detach(),d.reject(e)}).css({display:"none"}).appendTo(document.body).attr({src:b,"data-filename":c})}).promise()};return{readFileAsDataURL:b,createImage:c}}(),q=function(){var a={BACKSPACE:8,TAB:9,ENTER:13,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,B:66,E:69,I:73,J:74,K:75,L:76,R:82,S:83,U:85,Y:89,Z:90,SLASH:191,LEFTBRACKET:219,BACKSLASH:220,RIGHTBRACKET:221};return{isEdit:function(a){return j.contains([8,9,13,32],a)},isMove:function(a){return j.contains([37,38,39,40],a)},nameFromCode:i.invertObject(a),code:a}}(),r=function(a){var b=[],c=-1,d=a[0],e=function(){var b=n.create(),c={s:{path:[],offset:0},e:{path:[],offset:0}};return{contents:a.html(),bookmark:b?b.bookmark(d):c}},f=function(b){null!==b.contents&&a.html(b.contents),null!==b.bookmark&&n.createFromBookmark(d,b.bookmark).select()};this.undo=function(){0<c&&(c--,f(b[c]))},this.redo=function(){b.length-1>c&&(c++,f(b[c]))},this.recordUndo=function(){c++,b.length>c&&(b=b.slice(0,c)),b.push(e())},this.recordUndo()},s=function(){var b=function(b,c){if(h.jqueryVersion<1.9){var d={};return a.each(c,function(a,c){d[c]=b.css(c)}),d}return b.css.call(b,c)};this.stylePara=function(b,c){a.each(b.nodes(m.isPara,{includeAncestor:!0}),function(b,d){a(d).css(c)})},this.styleNodes=function(b,c){b=b.splitText();var d=c&&c.nodeName||"SPAN",e=!(!c||!c.expandClosestSibling),f=!(!c||!c.onlyPartialContains);if(b.isCollapsed())return[b.insertNode(m.create(d))];var g=m.makePredByNodeName(d),h=a.map(b.nodes(m.isText,{fullyContains:!0}),function(a){return m.singleChildAncestor(a,g)||m.wrap(a,d)});if(e){if(f){var k=b.nodes();g=i.and(g,function(a){return j.contains(k,a)})}return a.map(h,function(b){var c=m.withClosestSiblings(b,g),d=j.head(c),e=j.tail(c);return a.each(e,function(a,b){m.appendChildNodes(d,b.childNodes),m.remove(b)}),j.head(c)})}return h},this.current=function(c,d){var e=a(m.isText(c.sc)?c.sc.parentNode:c.sc),f=["font-family","font-size","text-align","list-style-type","line-height"],g=b(e,f)||{};if(g["font-size"]=parseInt(g["font-size"],10),g["font-bold"]=document.queryCommandState("bold")?"bold":"normal",g["font-italic"]=document.queryCommandState("italic")?"italic":"normal",g["font-underline"]=document.queryCommandState("underline")?"underline":"normal",g["font-strikethrough"]=document.queryCommandState("strikeThrough")?"strikethrough":"normal",g["font-superscript"]=document.queryCommandState("superscript")?"superscript":"normal",g["font-subscript"]=document.queryCommandState("subscript")?"subscript":"normal",c.isOnList()){var h=["circle","disc","disc-leading-zero","square"],i=a.inArray(g["list-style-type"],h)>-1;g["list-style"]=i?"unordered":"ordered"}else g["list-style"]="none";var j=m.ancestor(c.sc,m.isPara);if(j&&j.style["line-height"])g["line-height"]=j.style.lineHeight;else{var k=parseInt(g["line-height"],10)/parseInt(g["font-size"],10);g["line-height"]=k.toFixed(1)}return g.image=m.isImg(d)&&d,g.anchor=c.isOnAnchor()&&m.ancestor(c.sc,m.isAnchor),g.ancestors=m.listAncestor(c.sc,m.isEditable),g.range=c,g}},t=function(){this.insertOrderedList=function(){this.toggleList("OL")},this.insertUnorderedList=function(){this.toggleList("UL")},this.indent=function(){var b=this,c=n.create().wrapBodyInlineWithPara(),d=c.nodes(m.isPara,{includeAncestor:!0}),e=j.clusterBy(d,i.peq2("parentNode"));a.each(e,function(c,d){var e=j.head(d);m.isLi(e)?b.wrapList(d,e.parentNode.nodeName):a.each(d,function(b,c){a(c).css("marginLeft",function(a,b){return(parseInt(b,10)||0)+25})})}),c.select()},this.outdent=function(){var b=this,c=n.create().wrapBodyInlineWithPara(),d=c.nodes(m.isPara,{
includeAncestor:!0}),e=j.clusterBy(d,i.peq2("parentNode"));a.each(e,function(c,d){var e=j.head(d);m.isLi(e)?b.releaseList([d]):a.each(d,function(b,c){a(c).css("marginLeft",function(a,b){return b=parseInt(b,10)||0,b>25?b-25:""})})}),c.select()},this.toggleList=function(b){var c=this,d=n.create().wrapBodyInlineWithPara(),e=d.nodes(m.isPara,{includeAncestor:!0}),f=d.paraBookmark(e),g=j.clusterBy(e,i.peq2("parentNode"));if(j.find(e,m.isPurePara)){var h=[];a.each(g,function(a,d){h=h.concat(c.wrapList(d,b))}),e=h}else{var k=d.nodes(m.isList,{includeAncestor:!0}).filter(function(c){return!a.nodeName(c,b)});k.length?a.each(k,function(a,c){m.replace(c,b)}):e=this.releaseList(g,!0)}n.createFromParaBookmark(f,e).select()},this.wrapList=function(b,c){var d=j.head(b),e=j.last(b),f=m.isList(d.previousSibling)&&d.previousSibling,g=m.isList(e.nextSibling)&&e.nextSibling,h=f||m.insertAfter(m.create(c||"UL"),e);return b=a.map(b,function(a){return m.isPurePara(a)?m.replace(a,"LI"):a}),m.appendChildNodes(h,b),g&&(m.appendChildNodes(h,j.from(g.childNodes)),m.remove(g)),b},this.releaseList=function(b,c){var d=[];return a.each(b,function(b,e){var f=j.head(e),g=j.last(e),h=c?m.lastAncestor(f,m.isList):f.parentNode,i=h.childNodes.length>1?m.splitTree(h,{node:g.parentNode,offset:m.position(g)+1},{isSkipPaddingBlankHTML:!0}):null,k=m.splitTree(h,{node:f.parentNode,offset:m.position(f)},{isSkipPaddingBlankHTML:!0});e=c?m.listDescendant(k,m.isLi):j.from(k.childNodes).filter(m.isLi),!c&&m.isList(h.parentNode)||(e=a.map(e,function(a){return m.replace(a,"P")})),a.each(j.from(e).reverse(),function(a,b){m.insertAfter(b,h)});var l=j.compact([h,k,i]);a.each(l,function(b,c){var d=[c].concat(m.listDescendant(c,m.isList));a.each(d.reverse(),function(a,b){m.nodeLength(b)||m.remove(b,!0)})}),d=d.concat(e)}),d}},u=function(){var b=new t;this.insertTab=function(a,b,c){var d=m.createText(new Array(c+1).join(m.NBSP_CHAR));b=b.deleteContents(),b.insertNode(d,!0),b=n.create(d,c),b.select()},this.insertParagraph=function(){var c=n.create();c=c.deleteContents(),c=c.wrapBodyInlineWithPara();var d,e=m.ancestor(c.sc,m.isPara);if(e){if(m.isEmpty(e)&&m.isLi(e))return void b.toggleList(e.parentNode.nodeName);d=m.splitTree(e,c.getStartPoint());var f=m.listDescendant(e,m.isEmptyAnchor);f=f.concat(m.listDescendant(d,m.isEmptyAnchor)),a.each(f,function(a,b){m.remove(b)})}else{var g=c.sc.childNodes[c.so];d=a(m.emptyPara)[0],g?c.sc.insertBefore(d,g):c.sc.appendChild(d)}n.create(d,0).normalize().select()}},v=function(){this.tab=function(a,b){var c=m.ancestor(a.commonAncestor(),m.isCell),d=m.ancestor(c,m.isTable),e=m.listDescendant(d,m.isCell),f=j[b?"prev":"next"](e,c);f&&n.create(f,0).select()},this.createTable=function(b){for(var c,d=[],e=[],f=b[0],g=b[1],h=b.slice(2,b.length),i=0;i<f;i++)d.push("<td>(item)</td>"),e.push("<th>header</th>");c=d.join(""),e=e.join("");for(var j,k=[],l=0;l<g;l++)k.push("<tr>"+c+"</tr>");return j=k.join(""),a('<table class="'+h.join(" ")+'"><thead><tr>'+e+"</tr></thead><tbody>"+j+"</tbody></table>")[0]}},w="bogus",x=function(b){var c=new s,d=new v,e=new u,f=new t;this.createRange=function(a){return this.focus(a),n.create()},this.saveRange=function(a,b){this.focus(a),a.data("range",n.create()),b&&n.create().collapse().select()},this.saveNode=function(a){for(var b=[],c=0,d=a[0].childNodes.length;c<d;c++)b.push(a[0].childNodes[c]);a.data("childNodes",b)},this.restoreRange=function(a){var b=a.data("range");b&&(b.select(),this.focus(a))},this.restoreNode=function(a){a.html("");for(var b=a.data("childNodes"),c=0,d=b.length;c<d;c++)a[0].appendChild(b[c])},this.currentStyle=function(a){var b=n.create();return!!b&&(b.isOnEditable()&&c.current(b,a))};var g=function(a){var c=m.makeLayoutInfo(a).holder();b.bindCustomEvent(c,a.data("callbacks"),"before.command")(a.html(),a)},i=function(a){var c=m.makeLayoutInfo(a).holder();b.bindCustomEvent(c,a.data("callbacks"),"change")(a.html(),a)};this.undo=function(a){g(a),a.data("NoteHistory").undo(),i(a)},this.redo=function(a){g(a),a.data("NoteHistory").redo(),i(a)};for(var k=this,l=this.beforeCommand=function(a){g(a),k.focus(a)},o=this.afterCommand=function(a,b){a.data("NoteHistory").recordUndo(),b||i(a)},q=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","fontName"],r=0,x=q.length;r<x;r++)this[q[r]]=function(a){return function(b,c){l(b),document.execCommand(a,!1,c),o(b,!0)}}(q[r]);this.insertHorizontalRule=function(){var b=a("<div />");b.addClass("divider"),n.create().insertNode(b[0])},this.tab=function(a,b){var c=this.createRange(a);c.isCollapsed()&&c.isOnCell()?d.tab(c):(l(a),e.insertTab(a,c,b.tabsize),o(a))},this.untab=function(a){var b=this.createRange(a);b.isCollapsed()&&b.isOnCell()&&d.tab(b,!0)},this.insertParagraph=function(a){l(a),e.insertParagraph(a),o(a)},this.insertOrderedList=function(a){l(a),f.insertOrderedList(a),o(a)},this.insertUnorderedList=function(a){l(a),f.insertUnorderedList(a),o(a)},this.indent=function(a){l(a),f.indent(a),o(a)},this.outdent=function(a){l(a),f.outdent(a),o(a)},this.insertImage=function(a,c,d){p.createImage(c,d).then(function(b){l(a),b.css({display:"",width:Math.min(a.width(),b.width())}),n.create().insertNode(b[0]),n.createFromNodeAfter(b[0]).select(),o(a)}).fail(function(){var c=m.makeLayoutInfo(a).holder();b.bindCustomEvent(c,a.data("callbacks"),"image.upload.error")()})},this.insertNode=function(a,b){l(a),n.create().insertNode(b),n.createFromNodeAfter(b).select(),o(a)},this.insertText=function(a,b){l(a);var c=n.create().insertNode(m.createText(b));n.create(c,m.nodeLength(c)).select(),o(a)},this.pasteHTML=function(a,b){l(a);var c=n.create().pasteHTML(b);n.createFromNodeAfter(j.last(c)).select(),o(a)},this.formatBlock=function(a,b){l(a),b=h.isMSIE?"<"+b+">":b,document.execCommand("FormatBlock",!1,b),o(a)},this.formatPara=function(a){l(a),this.formatBlock(a,"P"),o(a)};for(var r=1;r<=6;r++)this["formatH"+r]=function(a){return function(b){this.formatBlock(b,"H"+a)}}(r);this.fontSize=function(b,d){var e=n.create(),f=e.isCollapsed();if(f){var g=c.styleNodes(e),h=j.head(g);a(g).css({"font-size":d+"px"}),h&&!m.nodeLength(h)&&(h.innerHTML=m.ZERO_WIDTH_NBSP_CHAR,n.createFromNodeAfter(h.firstChild).select(),b.data(w,h))}else l(b),a(c.styleNodes(e)).css({"font-size":d+"px"}),o(b)},this.removeBogus=function(a){var b=a.data(w);if(b){var c=j.find(j.from(b.childNodes),m.isText),d=c.nodeValue.indexOf(m.ZERO_WIDTH_NBSP_CHAR);d!==-1&&c.deleteData(d,1),m.isEmpty(b)&&m.remove(b),a.removeData(w)}},this.lineHeight=function(a,b){l(a),c.stylePara(n.create(),{lineHeight:b}),o(a)},this.unlink=function(a){var b=this.createRange(a);if(b.isOnAnchor()){var c=m.ancestor(b.sc,m.isAnchor);b=n.createFromNode(c),b.select(),l(a),document.execCommand("unlink"),o(a)}},this.createLink=function(b,d,e){var f=d.url,g=d.text,h=d.newWindow,i=d.range,k=i.toString()!==g;l(b),e.onCreateLink&&(f=e.onCreateLink(f));var m=[];if(k){var p=i.insertNode(a("<A>"+g+"</A>")[0]);m.push(p)}else m=c.styleNodes(i,{nodeName:"A",expandClosestSibling:!0,onlyPartialContains:!0});a.each(m,function(b,c){a(c).attr("href",f),h?a(c).attr("target","_blank"):a(c).removeAttr("target")});var q=n.createFromNodeBefore(j.head(m)),r=q.getStartPoint(),s=n.createFromNodeAfter(j.last(m)),t=s.getEndPoint();n.create(r.node,r.offset,t.node,t.offset).select(),o(b)},this.getLinkInfo=function(b){this.focus(b);var c=n.create().expand(m.isAnchor),d=a(j.head(c.nodes(m.isAnchor)));return{range:c,text:c.toString(),isNewWindow:!!d.length&&"_blank"===d.attr("target"),url:d.length?d.attr("href"):""}},this.color=function(a,b){var c=JSON.parse(b),d=c.foreColor,e=c.backColor;l(a),d&&document.execCommand("foreColor",!1,d),e&&document.execCommand("backColor",!1,e),o(a)},this.insertTable=function(a,b){var c=b.split("x");l(a);var e=n.create().deleteContents();e.insertNode(d.createTable(c)),o(a)},this.floatMe=function(a,b,c){l(a),c.css("float",b),o(a)},this.imageShape=function(a,b,c){l(a),c.removeClass("img-rounded img-circle img-thumbnail img-bordered"),b&&c.addClass(b),o(a)},this.imageClass=function(a,b,c){l(a),b&&(c.hasClass(b)?c.removeClass(b):c.addClass(b)),o(a)},this.resize=function(a,b,c){l(a),c.css({width:100*b+"%",height:""}),o(a)},this.resizeTo=function(a,b,c){var d;if(c){var e=a.y/a.x,f=b.data("ratio");d={width:f>e?a.x:a.y/f,height:f>e?a.x*f:a.y}}else d={width:a.x,height:a.y};b.css(d)},this.removeMedia=function(c,d,e){l(c),e.detach(),b.bindCustomEvent(a(),c.data("callbacks"),"media.delete")(e,c),o(c)},this.focus=function(a){a.focus(),h.isFF&&!n.create().isOnEditable()&&n.createFromNode(a[0]).normalize().collapse().select()},this.isEmpty=function(a){return m.isEmpty(a[0])||m.emptyPara===a.html()},this.empty=function(a){return a.html(m.emptyPara),a.html()}},y=function(){this.update=function(b,c){var d=function(b,c){b.find(".dropdown-menu li").each(function(){var b=a(this).children("div"),d=b.data("value");d+""==c+""?b.children("i").removeClass("transparent"):b.children("i").addClass("transparent")})},e=function(a,c){var d=b.find(a);d.toggleClass("active",c())};if(c.image){var f=a(c.image);e('.btn[data-event="imageClass"][data-value="img-rounded"]',function(){return f.hasClass("img-rounded")}),e('.btn[data-event="imageClass"][data-value="img-circle"]',function(){return f.hasClass("img-circle")}),e('.btn[data-event="imageClass"][data-value="img-thumbnail"]',function(){return f.hasClass("img-thumbnail")}),e('.btn[data-event="imageClass"][data-value="img-bordered"]',function(){return f.hasClass("img-bordered")}),e('.btn[data-event="imageShape"]:not([data-value])',function(){return!f.is(".img-rounded, .img-circle, .img-thumbnail, .img-bordered")});var g=f.css("float");e('.btn[data-event="floatMe"][data-value="left"]',function(){return"left"===g}),e('.btn[data-event="floatMe"][data-value="right"]',function(){return"right"===g}),e('.btn[data-event="floatMe"][data-value="none"]',function(){return"left"!==g&&"right"!==g});var i=f.attr("style");return e('.btn[data-event="resize"][data-value="1"]',function(){return!!/(^|\s)(max-)?width\s*:\s*100%/.test(i)}),e('.btn[data-event="resize"][data-value="0.5"]',function(){return!!/(^|\s)(max-)?width\s*:\s*50%/.test(i)}),void e('.btn[data-event="resize"][data-value="0.25"]',function(){return!!/(^|\s)(max-)?width\s*:\s*25%/.test(i)})}var j=b.find(".note-fontname[data-name=fontname]");if(j.length){var k=c["font-family"];if(k){for(var l=k.split(","),m=0,n=l.length;m<n&&(k=l[m].replace(/[\'\"]/g,"").replace(/\s+$/,"").replace(/^\s+/,""),!h.isFontInstalled(k));m++);j.find(".note-current-fontname").text(k),d(j,k)}}var o=b.find(".note-fontsize[data-name=fontsize]");o.find(".note-current-fontsize").text(c["font-size"]),d(o,parseFloat(c["font-size"]));var p=b.find(".note-height[data-name=lineheight]");d(p,parseFloat(c["line-height"])),e('.btn[data-event="bold"]',function(){return"bold"===c["font-bold"]}),e('.btn[data-event="italic"]',function(){return"italic"===c["font-italic"]}),e('.btn[data-event="underline"]',function(){return"underline"===c["font-underline"]}),e('.btn[data-event="strikethrough"]',function(){return"strikethrough"===c["font-strikethrough"]}),e('.btn[data-event="superscript"]',function(){return"superscript"===c["font-superscript"]}),e('.btn[data-event="subscript"]',function(){return"subscript"===c["font-subscript"]}),e('.btn[data-event="justifyLeft"]',function(){return"left"===c["text-align"]||"start"===c["text-align"]}),e('.btn[data-event="justifyCenter"]',function(){return"center"===c["text-align"]}),e('.btn[data-event="justifyRight"]',function(){return"right"===c["text-align"]}),e('.btn[data-event="justifyFull"]',function(){return"justify"===c["text-align"]}),e('.btn[data-event="insertUnorderedList"]',function(){return"unordered"===c["list-style"]}),e('.btn[data-event="insertOrderedList"]',function(){return"ordered"===c["list-style"]})},this.updateRecentColor=function(b,c,d){var e=a(b).closest(".note-color"),f=e.find(".note-recent-color"),g=JSON.parse(f.attr("data-value")),h="backColor"===c?"background-color":"color";g[c]=d,f.attr("data-value",JSON.stringify(g)),f.css(h,d)}},z=function(){var a=new y;this.update=function(b,c){a.update(b,c)},this.updateRecentColor=function(b,c,d){a.updateRecentColor(b,c,d)},this.activate=function(a){a.find("button, .btn").not('.btn[data-event="codeview"]').removeClass("disabled")},this.deactivate=function(a){a.find("button, .btn").not('.btn[data-event="codeview"]').addClass("disabled")},this.updateFullscreen=function(a,b){var c=a.find('.btn[data-event="fullscreen"]');c.toggleClass("active",b)},this.updateCodeview=function(a,b){var c=a.find('.btn[data-event="codeview"]');c.toggleClass("active",b),b?this.deactivate(a):this.activate(a)},this.get=function(a,b){var c=m.makeLayoutInfo(a).toolbar();return c.find("[data-name="+b+"]")},this.setButtonState=function(a,b,c){c=c!==!1;var d=this.get(a,b);d.toggleClass("active",c)}},A=24,B=function(){var b=a(document);this.attach=function(a,b){b.disableResizeEditor||a.statusbar().on("mousedown",c)};var c=function(a){a.preventDefault(),a.stopPropagation();var c=m.makeLayoutInfo(a.target).editable(),d=c.offset().top-b.scrollTop(),e=m.makeLayoutInfo(a.currentTarget||a.target),f=e.editor().data("options");b.on("mousemove",function(a){var b=a.clientY-(d+A);b=f.minHeight>0?Math.max(b,f.minHeight):b,b=f.maxHeight>0?Math.min(b,f.maxHeight):b,c.height(b)}).one("mouseup",function(){b.off("mousemove")})}},C=function(){var b=new y,c=function(b,c){var d=a(b),e=c?d.offset():d.position(),f=d.outerHeight(!0);return{left:e.left,top:e.top+f}},d=function(a,b){a.css({display:"block",left:b.left,top:b.top})},e=20;this.update=function(f,g,h){b.update(f,g);var k=f.find(".note-link-popover");if(g.anchor){var l=k.find("a"),m=a(g.anchor).attr("href"),n=a(g.anchor).attr("target");l.attr("href",m).html(m),n?l.attr("target","_blank"):l.removeAttr("target"),d(k,c(g.anchor,h))}else k.hide();var o=f.find(".note-image-popover");g.image?d(o,c(g.image,h)):o.hide();var p=f.find(".note-air-popover");if(h&&!g.range.isCollapsed()){var q=j.last(g.range.getClientRects());if(q){var r=i.rect2bnd(q);d(p,{left:Math.max(r.left+r.width/2-e,0),top:r.top+r.height})}}else p.hide()},this.updateRecentColor=function(a,b,c){a.updateRecentColor(a,b,c)},this.hide=function(a){a.children().hide()}},D=function(b){var c=a(document),d=function(d){if(m.isControlSizing(d.target)){d.preventDefault(),d.stopPropagation();var e=m.makeLayoutInfo(d.target),f=e.handle(),g=e.popover(),h=e.editable(),i=e.editor(),j=f.find(".note-control-selection").data("target"),k=a(j),l=k.offset(),n=c.scrollTop(),o=i.data("options").airMode;c.on("mousemove",function(a){b.invoke("editor.resizeTo",{x:a.clientX-l.left,y:a.clientY-(l.top-n)},k,!a.shiftKey),b.invoke("handle.update",f,{image:j},o),b.invoke("popover.update",g,{image:j},o)}).one("mouseup",function(){c.off("mousemove"),b.invoke("editor.afterCommand",h)}),k.data("ratio")||k.data("ratio",k.height()/k.width())}};this.attach=function(a){a.handle().on("mousedown",d)},this.update=function(b,c,d){var e=b.find(".note-control-selection");if(c.image){var f=a(c.image),g=d?f.offset():f.position(),h={w:f.outerWidth(!0),h:f.outerHeight(!0)};e.css({display:"block",left:g.left,top:g.top,width:h.w,height:h.h}).data("target",c.image);var i=h.w+"x"+h.h;e.find(".note-control-selection-info").text(i)}else e.hide()},this.hide=function(a){a.children().hide()}},E=function(b){var c=a(window),d=a("html, body");this.toggle=function(a){var e=a.editor(),f=a.toolbar(),g=a.editable(),h=a.codable(),i=function(a){g.css("height",a.h),h.css("height",a.h),h.data("cmeditor")&&h.data("cmeditor").setsize(null,a.h)};e.toggleClass("fullscreen");var j=e.hasClass("fullscreen");j?(g.data("orgheight",g.css("height")),c.on("resize",function(){i({h:c.height()-f.outerHeight()})}).trigger("resize"),d.css("overflow","hidden"),f.css("top",0)):(c.off("resize"),i({h:g.data("orgheight")}),d.css("overflow","visible")),b.invoke("toolbar.updateFullscreen",f,j)}};h.hasCodeMirror&&(h.isSupportAmd?require(["CodeMirror"],function(a){f=a}):f=window.CodeMirror);var F=function(b){this.sync=function(a){var c=b.invoke("codeview.isActivated",a);c&&h.hasCodeMirror&&a.codable().data("cmEditor").save()},this.isActivated=function(a){var b=a.editor();return b.hasClass("codeview")},this.toggle=function(a){this.isActivated(a)?this.deactivate(a):this.activate(a)},this.activate=function(c){function d(a,b,c,e){var f,g=a.indexOf("<"),h=a.indexOf(">");if(0===g)if(f=a.substring(0,h+1),a=a.substring(h+1),0===f.indexOf("</"))b--,nsideLastBlock=!1;else{c&&b++;for(var i=!1,j=0;j<e.length;j++)if(0===f.indexOf(e[j])){i=!0;break}c=!i}else f=a.substring(0,g),a=a.substring(g),c&&b++,c=!1;return f=new Array(b+1).join("    ")+f.trim(),0===a.length?f:f+"\n"+d(a.trim(),b,c,e)}var e=c.editor(),g=c.toolbar(),i=c.editable(),j=c.codable(),k=c.popover(),l=c.handle(),n=e.data("options"),o=m.html(i,!1),p=["<img","<br","<hr"];o=d(o,0,!1,p),j.val(o);var q=g.find(".btn[data-event=codeview]").height(),r=a(window).height()-q;if(j.height(i.height()),b.invoke("toolbar.updateCodeview",g,!0),b.invoke("popover.hide",k),b.invoke("handle.hide",l),e.addClass("codeview"),j.focus(),h.hasCodeMirror){var s=f.fromTextArea(j[0],n.codemirror);if(n.codemirror.tern){var t=new f.TernServer(n.codemirror.tern);s.ternServer=t,s.on("cursorActivity",function(a){t.updateArgHints(a)})}e.hasClass("fullscreen")?s.setSize(null,r):s.setSize(null,i.outerHeight()),j.data("cmEditor",s)}},this.deactivate=function(a){var c=a.holder(),d=a.editor(),e=a.toolbar(),f=a.editable(),g=a.codable(),i=d.data("options");if(h.hasCodeMirror){var j=g.data("cmEditor");g.val(j.getValue()),j.toTextArea()}var k=m.value(g,i.prettifyHtml)||m.emptyPara,l=f.html()!==k;f.html(k),f.height(i.height?g.height():"auto"),d.removeClass("codeview"),l&&b.bindCustomEvent(c,f.data("callbacks"),"change")(f.html(),f),f.focus(),b.invoke("toolbar.updateCodeview",e,!1)}},G=function(b){var c=a(document);this.attach=function(a,b){b.airMode||b.disableDragAndDrop?c.on("drop",function(a){a.preventDefault()}):this.attachDragAndDropEvent(a,b)},this.attachDragAndDropEvent=function(d,e){var f=a(),g=d.editor(),h=d.dropzone(),i=h.find(".note-dropzone-message");c.on("dragenter",function(a){var c=b.invoke("codeview.isActivated",d),j=g.width()>0&&g.height()>0;c||f.length||!j||(g.addClass("dragover"),h.width(g.width()),h.height(g.height()),i.text(e.langInfo.image.dragImageHere)),f=f.add(a.target)}).on("dragleave",function(a){f=f.not(a.target),f.length||g.removeClass("dragover")}).on("drop",function(){f=a(),g.removeClass("dragover")}),h.on("dragenter",function(){h.addClass("hover"),i.text(e.langInfo.image.dropImage)}).on("dragleave",function(){h.removeClass("hover"),i.text(e.langInfo.image.dragImageHere)}),h.on("drop",function(c){var d=c.originalEvent.dataTransfer,e=m.makeLayoutInfo(c.currentTarget||c.target);if(d&&d.files&&d.files.length)c.preventDefault(),e.editable().focus(),b.insertImages(e,d.files);else for(var f=function(){e.holder().materialnote("insertNode",this)},g=0,h=d.types.length;g<h;g++){var i=d.types[g],j=d.getData(i);i.toLowerCase().indexOf("text")>-1?e.holder().materialnote("pasteHTML",j):a(j).each(f)}}).on("dragover",!1)}},H=function(b){var c;this.attach=function(e){(window.clipboardData||h.isFF)&&(c=a("<div />").attr("contenteditable",!0).css({position:"absolute",left:-1e5,opacity:0}),e.editable().after(c),c.one("paste",d),e.editable().on("keydown",function(a){a.ctrlKey&&86===a.keyCode&&(b.invoke("saveRange",e.editable()),c&&c.focus())})),e.editable().on("paste",d)};var d=function(a){var d=a.originalEvent.clipboardData,e=m.makeLayoutInfo(a.currentTarget||a.target),f=e.editable();if(!d||!d.items||!d.items.length){var g=f.data("callbacks");if(!g.onImageUpload)return;return void setTimeout(function(){if(c){var a=c[0].firstChild;if(a){if(b.invoke("restoreRange",f),m.isImg(a)){for(var d=a.src,g=atob(d.split(",")[1]),h=new Uint8Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Blob([h],{type:"image/png"});j.name="clipboard.png",b.invoke("focus",f),b.insertImages(e,[j])}else b.invoke("pasteHTML",f,c.html());c.remove()}}},0)}var h=j.head(d.items),i="file"===h.kind&&h.type.indexOf("image/")!==-1;i&&b.insertImages(e,[h.getAsFile()]),b.invoke("editor.afterCommand",f)}},I=function(b){var c=function(a,b){a.toggleClass("disabled",!b),a.attr("disabled",!b)},d=function(a,b){a.on("keypress",function(a){a.keyCode===q.code.ENTER&&b.trigger("click")})};this.showLinkDialog=function(b,e,f){return a.Deferred(function(b){var g=e.find(".note-link-dialog"),h=g.find(".note-link-text"),i=h.next("label"),j=g.find(".note-link-url"),k=g.find(".note-link-btn"),l=g.find(".btnClose"),m=g.find("input[type=checkbox]");g.openModal(),h.val(f.text),f.text.length>0&&i.addClass("active"),h.on("keyup",function(){c(k,h.val()&&j.val()),f.text=h.val()}),l.click(function(a){a.preventDefault(),g.closeModal()}),f.url||(f.url=f.text||"http://",c(k,f.text)),j.on("keyup",function(){c(k,h.val()&&j.val()),f.text||(i.addClass("active"),h.val(j.val()))}).val(f.url).trigger("focus").trigger("select"),d(j,k),d(h,k),m.prop("checked",f.newWindow),k.one("click",function(c){c.preventDefault(),b.resolve({range:f.range,url:j.val(),text:h.val(),newWindow:m.is(":checked")}),a(".note-link-text").val(""),a(".note-link-text").next("label").removeClass("active"),a(".note-link-url").val(""),g.closeModal()})}).promise()},this.show=function(a){var c=a.editor(),d=a.dialog(),e=a.editable(),f=a.popover(),g=b.invoke("editor.getLinkInfo",e),h=c.data("options");b.invoke("editor.saveRange",e),this.showLinkDialog(e,d,g).then(function(a){b.invoke("editor.restoreRange",e),b.invoke("editor.createLink",e,a,h),b.invoke("popover.hide",f)}).fail(function(){b.invoke("editor.restoreRange",e)})}},J=function(b){var c=function(a,b){a.toggleClass("disabled",!b),a.attr("disabled",!b)},d=function(a,b){a.on("keypress",function(a){a.keyCode===q.code.ENTER&&b.trigger("click")})};this.show=function(a){var c=a.dialog(),d=a.editable();b.invoke("editor.saveRange",d),this.showImageDialog(d,c).then(function(c){b.invoke("editor.restoreRange",d),"string"==typeof c?b.invoke("editor.insertImage",d,c):b.insertImages(a,c)}).fail(function(){b.invoke("editor.restoreRange",d)})},this.showImageDialog=function(b,e){return a.Deferred(function(a){var b=e.find(".note-image-dialog"),f=e.find(".note-image-input"),g=e.find(".note-image-url"),h=e.find(".note-image-btn"),i=b.find(".btnClose");b.openModal(),f.replaceWith(f.clone().on("change",function(){a.resolve(this.files||this.value),g.val(""),b.closeModal(),a.resolve()}).val("")),h.click(function(c){c.preventDefault(),a.resolve(g.val()),g.val(""),b.closeModal(),a.resolve()}),i.click(function(a){a.preventDefault(),b.closeModal()}),g.on("keyup paste",function(a){var b;b="paste"===a.type?a.originalEvent.clipboardData.getData("text"):g.val(),c(h,b)}),d(g,h)})}},K=function(b){this.showHelpDialog=function(b,c){return a.Deferred(function(a){var b=c.find(".note-help-dialog");b.openModal(),a.resolve()}).promise()},this.show=function(a){var c=a.dialog(),d=a.editable();b.invoke("editor.saveRange",d,!0),this.showHelpDialog(d,c).then(function(){b.invoke("editor.restoreRange",d)})}},L=function(){var b=this.modules={editor:new x(this),toolbar:new z(this),statusbar:new B(this),popover:new C(this),handle:new D(this),fullscreen:new E(this),codeview:new F(this),dragAndDrop:new G(this),clipboard:new H(this),linkDialog:new I(this),imageDialog:new J(this),helpDialog:new K(this)};this.invoke=function(){var a=j.head(j.from(arguments)),b=j.tail(j.from(arguments)),c=a.split("."),d=c.length>1,e=d&&j.head(c),f=d?j.last(c):j.head(c),g=this.getModule(e),h=g[f];return h&&h.apply(g,b)},this.getModule=function(a){return this.modules[a]||this.modules.editor};var c=this.bindCustomEvent=function(a,b,c){return function(){var d=b[i.namespaceToCamel(c,"on")];return d&&d.apply(a[0],arguments),a.trigger("materialnote."+c,arguments)}};this.insertImages=function(d,e){var f=d.editor(),g=d.editable(),h=d.holder(),i=g.data("callbacks"),j=f.data("options");i.onImageUpload?c(h,i,"image.upload")(e):a.each(e,function(a,d){var e=d.name;j.maximumImageFileSize&&j.maximumImageFileSize<d.size?c(h,i,"image.upload.error")(j.langInfo.image.maximumFileSizeError):p.readFileAsDataURL(d).then(function(a){b.editor.insertImage(g,a,e)}).fail(function(){c(h,i,"image.upload.error")(j.langInfo.image.maximumFileSizeError)})})};var d={showLinkDialog:function(a){b.linkDialog.show(a)},showImageDialog:function(a){b.imageDialog.show(a)},showHelpDialog:function(a){b.helpDialog.show(a)},fullscreen:function(a){b.fullscreen.toggle(a)},codeview:function(a){b.codeview.toggle(a)}},e=function(a){m.isImg(a.target)&&a.preventDefault()},f=function(a){var c=m.makeLayoutInfo(a.currentTarget||a.target);b.editor.removeBogus(c.editable()),g(a)},g=function(a){setTimeout(function(){var c=m.makeLayoutInfo(a.currentTarget||a.target),d=b.editor.currentStyle(a.target);if(d){var e=c.editor().data("options").airMode;e||b.toolbar.update(c.toolbar(),d),b.popover.update(c.popover(),d,e),b.handle.update(c.handle(),d,e)}},0)},k=function(a){var c=m.makeLayoutInfo(a.currentTarget||a.target);b.popover.hide(c.popover()),b.handle.hide(c.handle())},l=function(b){var c=a(b.target).closest("[data-event]");c.length&&b.preventDefault()},n=function(c){var e=a(c.target).closest("[data-event]");if(e.length){var f,h=e.attr("data-event"),i=e.attr("data-value"),k=e.attr("data-hide"),l=m.makeLayoutInfo(c.target);if(a.inArray(h,["resize","floatMe","removeMedia","imageShape","imageClass"])!==-1){var n=l.handle().find(".note-control-selection");f=a(n.data("target"))}if(k&&e.parents(".popover").hide(),a.isFunction(a.materialnote.pluginEvents[h]))a.materialnote.pluginEvents[h](c,b.editor,l,i);else if(b.editor[h]){var o=l.editable();o.focus(),b.editor[h](o,i,f),c.preventDefault()}else d[h]&&(d[h].call(this,l),c.preventDefault());if(a.inArray(h,["backColor","foreColor"])!==-1){var p=l.editor().data("options",p),q=p.airMode?b.popover:b.toolbar;q.updateRecentColor(j.head(e),h,i)}g(c)}},o=26,s=function(b,c){var d,e=a(b.target.parentNode),f=e.parent(),g=e.next(),h=e.find(".note-dimension-picker-mousecatcher"),i=e.find(".note-dimension-picker-highlighted"),j=e.find(".note-dimension-picker-unhighlighted"),k=f.find("[id$='-hoverable']"),l=f.find("[id$='-bordered']"),m=f.find("[id$='-striped']"),n=f.find("[id$='-responsive']");if(void 0===b.offsetX){var p=a(b.target).offset();d={x:b.pageX-p.left,y:b.pageY-p.top}}else d={x:b.offsetX,y:b.offsetY};var q={c:Math.ceil(d.x/o)||1,r:Math.ceil(d.y/o)||1},r=[];k.is(":checked")&&r.push("hoverable"),l.is(":checked")&&r.push("bordered"),m.is(":checked")&&r.push("striped"),n.is(":checked")&&r.push("responsive-table"),i.css({width:q.c*o+"px",height:q.r*o+"px"}),h.attr("data-value",q.c+"x"+q.r+"x"+r.join("x")),j.css({width:c.insertTableMaxSize*o+"px"}),3<q.r&&q.r<c.insertTableMaxSize.row&&j.css({height:(q.r+1)*o+"px"}),g.html(q.c+" x "+q.r)};this.bindKeyMap=function(c,e){var f=c.editor(),g=c.editable();g.on("keydown",function(h){var i=[];h.metaKey&&i.push("CMD"),h.ctrlKey&&!h.altKey&&i.push("CTRL"),h.shiftKey&&i.push("SHIFT");var j=q.nameFromCode[h.keyCode];j&&i.push(j);var k,l=i.join("+"),m=e[l];if(m){if(k=a.materialnote.pluginEvents[l],a.isFunction(k)&&k(h,b.editor,c))return!1;k=a.materialnote.pluginEvents[m],a.isFunction(k)?k(h,b.editor,c):b.editor[m]?(b.editor[m](g,f.data("options")),h.preventDefault()):d[m]&&(d[m].call(this,c),h.preventDefault())}else q.isEdit(h.keyCode)&&b.editor.afterCommand(g)})},this.attach=function(a,c){c.shortcuts&&this.bindKeyMap(a,c.keyMap[h.isMac?"mac":"pc"]),a.editable().on("mousedown",e),a.editable().on("keyup mouseup",f),a.editable().on("scroll",k),b.clipboard.attach(a,c),b.handle.attach(a,c),a.popover().on("click",n),a.popover().on("mousedown",l),b.dragAndDrop.attach(a,c),c.airMode||(a.toolbar().on("click",n),a.toolbar().on("mousedown",l),b.statusbar.attach(a,c));var d=c.airMode?a.popover():a.toolbar(),g=d.find(".note-dimension-picker-mousecatcher");g.css({width:c.insertTableMaxSize.col*o+"px",height:c.insertTableMaxSize.row*o+"px"}).on("mousemove",function(a){s(a,c)}),a.editor().data("options",c),h.isMSIE||setTimeout(function(){document.execCommand("styleWithCSS",0,c.styleWithSpan)},0);var i=new r(a.editable());a.editable().data("NoteHistory",i),a.editable().data("callbacks",{onInit:c.onInit,onFocus:c.onFocus,onBlur:c.onBlur,onKeydown:c.onKeydown,onKeyup:c.onKeyup,onMousedown:c.onMousedown,onEnter:c.onEnter,onPaste:c.onPaste,onBeforeCommand:c.onBeforeCommand,onChange:c.onChange,onImageUpload:c.onImageUpload,onImageUploadError:c.onImageUploadError,onMediaDelete:c.onMediaDelete,onToolbarClick:c.onToolbarClick}),m.isTextarea(j.head(a.holder()))&&a.holder().closest("form").submit(function(){a.holder().val(a.holder().code())})},this.attachCustomEvent=function(b,d){var e=b.holder(),f=b.editable(),g=f.data("callbacks");f.focus(c(e,g,"focus")),f.blur(c(e,g,"blur")),f.keydown(function(a){a.keyCode===q.code.ENTER&&c(e,g,"enter").call(this,a),c(e,g,"keydown").call(this,a)}),f.keyup(c(e,g,"keyup")),f.on("mousedown",c(e,g,"mousedown")),f.on("mouseup",c(e,g,"mouseup")),f.on("scroll",c(e,g,"scroll")),f.on("paste",c(e,g,"paste"));var i=h.isMSIE?"DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted":"input";f.on(i,function(){c(e,g,"change")(f.html(),f)}),d.airMode||(b.toolbar().click(c(e,g,"toolbar.click")),b.popover().click(c(e,g,"popover.click"))),m.isTextarea(j.head(e))&&e.closest("form").submit(function(a){c(e,g,"submit").call(this,a,e.code())}),c(e,g,"init")(b);for(var k=0,l=a.materialnote.plugins.length;k<l;k++)a.isFunction(a.materialnote.plugins[k].init)&&a.materialnote.plugins[k].init(b)},this.detach=function(a,b){a.holder().off(),a.editable().off(),a.popover().off(),a.handle().off(),a.dialog().off(),b.airMode||(a.dropzone().off(),a.toolbar().off(),a.statusbar().off())}},M=function(){var b=function(a,b){var c=b.event,d=b.value,e=b.title,f=b.style,g=b.btnClassName,h=b.className,i=b.dropdown,j=b.hide;if(i){var k=['<div class="btn-group',(h?" "+h:"")+'">','<button class="waves-effect waves-light btn dropdown '+(g?g:"")+'"',e?' title="'+e+'"':"",c?' data-event="'+c+'"':"",d?" data-value='"+d+"'":"",j?" data-hide='"+j+"'":"",'><i class="material-icons left">arrow_drop_down</i>'+a+"</button>",i,"</div>"].join("");return k}var l=['<div class="waves-effect waves-light btn',(h?" "+h:"")+'"',e?' title="'+e+'"':"",f?' style="'+f+'"':"",c?' data-event="'+c+'"':"",d?" data-value='"+d+"'":"",j?" data-hide='"+j+"'":"",' tabindex="-1">'+a+"</div>"].join("");return l},c=function(a,c){var d='<i class="material-icons">'+a+"</i>";return b(d,c)},d=function(b,c){var d=a('<div class="'+b+' popover bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content"></div></div>');return d.find(".popover-content").append(c),d},e=function(a,b,c,d){var e=['<div class="'+a+' modal modal-fixed-footer">','<div class="modal-content">',b?"<h4>"+b+"</h4>":"","<p>"+c+"</p>","</div>",d?'<div class="modal-footer">'+d+"</div>":"","</div>"].join("");return e},f={picture:function(a,b){return c(b.iconPrefix+b.icons.image.image,{event:"showImageDialog",title:a.image.image,hide:!0})},link:function(a,b){return c(b.iconPrefix+b.icons.link.link,{event:"showLinkDialog",title:a.link.link,hide:!0})},table:function(a,b){var d='<ul class="note-table dropdown-menu"><div class="row"><div class="col s6 preventDropClose"><input type="checkbox" id="'+materialUniqueId+'-bordered" checked="checked" /><label for="'+materialUniqueId+'-bordered">'+a.table.bordered+'</label></div><div class="col s6 preventDropClose"><input type="checkbox" id="'+materialUniqueId+'-striped" checked="checked" /><label for="'+materialUniqueId+'-striped">'+a.table.striped+'</label></div></div><div class="row"><div class="col s6 preventDropClose"><input type="checkbox" id="'+materialUniqueId+'-hoverable" checked="checked" /><label for="'+materialUniqueId+'-hoverable">'+a.table.hoverable+'</label></div><div class="col s6 preventDropClose"><input type="checkbox" id="'+materialUniqueId+'-responsive" checked="checked" /><label for="'+materialUniqueId+'-responsive">'+a.table.responsive+'</label></div></div><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></ul>';
return c(b.iconPrefix+b.icons.table.table,{title:a.table.table,dropdown:d})},style:function(a,b){var d=b.styleTags.reduce(function(b,c){var d=a.style["p"===c?"normal":c];return b+'<li><div data-event="formatBlock" data-value="'+c+'">'+("p"===c||"pre"===c?d:"<"+c+">"+d+"</"+c+">")+"</div></li>"},"");return c(b.iconPrefix+b.icons.style.style,{title:a.style.style,dropdown:'<ul class="dropdown-menu largeDropdown">'+d+"</ul>"})},fontname:function(a,c){var d=[],e=c.fontNames.reduce(function(a,b){return h.isFontInstalled(b)||c.fontNamesIgnoreCheck.indexOf(b)!==-1?(d.push(b),a+'<li><div data-event="fontName" href="#" data-value="'+b+'" style="font-family:\''+b+'\'"><i class="material-icons tiny transparent">'+c.iconPrefix+c.icons.misc.check+"</i> "+b+"</div></li>"):a},""),f=h.isFontInstalled(c.defaultFontName),g=f?c.defaultFontName:d[0],i='<div class="note-current-fontname">'+g+"</div>";return b(i,{title:a.font.name,className:"note-fontname",dropdown:'<ul class="dropdown-menu note-check">'+e+"</ul>"})},fontsize:function(a,c){var d=c.fontSizes.reduce(function(a,b){return a+'<li><div data-event="fontSize" href="#" data-value="'+b+'"><i class="material-icons tiny transparent">'+c.iconPrefix+c.icons.misc.check+"</i> "+b+"</div></li>"},""),e='<span class="note-current-fontsize">15</span>';return b(e,{title:a.font.size,className:"note-fontsize",dropdown:'<ul class="dropdown-menu note-check">'+d+"</ul>"})},color:function(a,c){var d='<i class="material-icons">'+c.icons.color.recent+"</i>",e=b(d,{className:"note-recent-color",title:a.color.recent,style:"color: "+c.defaultTextColor+"; background-color: "+c.defaultBackColor+";",event:"color",value:'{"backColor": "'+c.defaultBackColor+'"}'}),f='<ul id="colors" class="dropdown-menu"><li><div class="col s12"><ul class="tabs"><li class="tab"><a href="#'+materialUniqueId+'-foreColor" class="active">'+a.color.foreground+'</a></li><li class="tab"><a href="#'+materialUniqueId+'-backColor">'+a.color.background+'</a></li></ul></div><div class="col s12 colorTable"><div id="'+materialUniqueId+'-foreColor"><div class="note-color-reset waves-effect waves-light btn" data-event="foreColor" data-value="'+c.defaultTextColor+'" title="'+a.color.reset+'">'+a.color.resetToDefault+'</div><div class="colorName"></div><div class="note-color-palette" data-target-event="foreColor"></div></div><div id="'+materialUniqueId+'-backColor"><div class="note-color-reset waves-effect waves-light btn" data-event="backColor" data-value="'+c.defaultBackColor+'" title="'+a.color.transparent+'">'+a.color.setTransparent+'</div><div class="colorName"></div><div class="note-color-palette" data-target-event="backColor"></div></div></div></li></ul>',g=b("",{title:a.color.more,className:"closeLeft",dropdown:f});return g+e},bold:function(a,b){return c(b.iconPrefix+b.icons.font.bold,{event:"bold",title:a.font.bold})},italic:function(a,b){return c(b.iconPrefix+b.icons.font.italic,{event:"italic",title:a.font.italic})},underline:function(a,b){return c(b.iconPrefix+b.icons.font.underline,{event:"underline",title:a.font.underline})},strikethrough:function(a,b){return c(b.iconPrefix+b.icons.font.strikethrough,{event:"strikethrough",title:a.font.strikethrough})},superscript:function(a,b){return c(b.iconPrefix+b.icons.font.superscript,{event:"superscript",title:a.font.superscript})},subscript:function(a,b){return c(b.iconPrefix+b.icons.font.subscript,{event:"subscript",title:a.font.subscript})},clear:function(a,b){return c(b.iconPrefix+b.icons.font.clear,{event:"removeFormat",title:a.font.clear})},ul:function(a,b){return c(b.iconPrefix+b.icons.lists.unordered,{event:"insertUnorderedList",title:a.lists.unordered})},ol:function(a,b){return c(b.iconPrefix+b.icons.lists.ordered,{event:"insertOrderedList",title:a.lists.ordered})},leftButton:function(a,b){return c(b.iconPrefix+b.icons.paragraph.left,{title:a.paragraph.left,event:"justifyLeft"})},centerButton:function(a,b){return c(b.iconPrefix+b.icons.paragraph.center,{title:a.paragraph.center,event:"justifyCenter"})},rightButton:function(a,b){return c(b.iconPrefix+b.icons.paragraph.right,{title:a.paragraph.right,event:"justifyRight"})},justifyButton:function(a,b){return c(b.iconPrefix+b.icons.paragraph.justify,{title:a.paragraph.justify,event:"justifyFull"})},outdentButton:function(a,b){return c(b.iconPrefix+b.icons.paragraph.outdent,{title:a.paragraph.outdent,event:"outdent"})},indentButton:function(a,b){return c(b.iconPrefix+b.icons.paragraph.indent,{title:a.paragraph.indent,event:"indent"})},paragraph:function(a,b){var d=c(b.iconPrefix+b.icons.paragraph.left,{title:a.paragraph.left,event:"justifyLeft"}),e=c(b.iconPrefix+b.icons.paragraph.center,{title:a.paragraph.center,event:"justifyCenter"}),f=c(b.iconPrefix+b.icons.paragraph.right,{title:a.paragraph.right,event:"justifyRight"}),g=c(b.iconPrefix+b.icons.paragraph.justify,{title:a.paragraph.justify,event:"justifyFull"}),h=c(b.iconPrefix+b.icons.paragraph.outdent,{title:a.paragraph.outdent,event:"outdent"}),i=c(b.iconPrefix+b.icons.paragraph.indent,{title:a.paragraph.indent,event:"indent"}),j='<ul class="dropdown-menu"><div class="note-align btn-group">'+d+e+f+g+'</div><div class="note-list btn-group">'+i+h+"</div></ul>";return c(b.iconPrefix+b.icons.paragraph.paragraph,{title:a.paragraph.paragraph,dropdown:j})},lineheight:function(a,b){var d=b.lineHeights.reduce(function(a,c){return a+'<li><div data-event="lineHeight" href="#" data-value="'+parseFloat(c)+'"><i class="material-icons tiny transparent">'+b.iconPrefix+b.icons.misc.check+"</i> "+c+"</div></li>"},"");return c(b.iconPrefix+b.icons.font.height,{title:a.font.height,className:"note-height",dropdown:'<ul class="dropdown-menu note-check">'+d+"</ul>"})},help:function(a,b){return c(b.iconPrefix+b.icons.options.help,{event:"showHelpDialog",title:a.options.help,hide:!0})},fullscreen:function(a,b){return c(b.iconPrefix+b.icons.options.fullscreen,{event:"fullscreen",title:a.options.fullscreen})},codeview:function(a,b){return c(b.iconPrefix+b.icons.options.codeview,{event:"codeview",title:a.options.codeview})},undo:function(a,b){return c(b.iconPrefix+b.icons.history.undo,{event:"undo",title:a.history.undo})},redo:function(a,b){return c(b.iconPrefix+b.icons.history.redo,{event:"redo",title:a.history.redo})},hr:function(a,b){return c(b.iconPrefix+b.icons.hr.insert,{event:"insertHorizontalRule",title:a.hr.insert})}},g=function(e,g){var h=function(){var a=c(g.iconPrefix+g.icons.link.edit,{title:e.link.edit,event:"showLinkDialog",hide:!0}),b=c(g.iconPrefix+g.icons.link.unlink,{title:e.link.unlink,event:"unlink"}),f='<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group">'+a+b+"</div>";return d("note-link-popover",f)},i=function(){var a=(b('<span class="note-fontsize-10">100%</span>',{title:e.image.resizeFull,event:"resize",value:"1"}),b('<span class="note-fontsize-10">50%</span>',{title:e.image.resizeHalf,event:"resize",value:"0.5"}),b('<span class="note-fontsize-10">25%</span>',{title:e.image.resizeQuarter,event:"resize",value:"0.25"}),c(g.iconPrefix+g.icons.image.floatLeft,{title:e.image.floatLeft,event:"floatMe",value:"left"})),f=c(g.iconPrefix+g.icons.image.floatRight,{title:e.image.floatRight,event:"floatMe",value:"right"}),h=c(g.iconPrefix+g.icons.image.floatNone,{title:e.image.floatNone,event:"floatMe",value:"none"}),i=c(g.iconPrefix+g.icons.image.shapeRounded,{title:e.image.shapeRounded,event:"imageClass",value:"img-rounded"}),j=c(g.iconPrefix+g.icons.image.shapeCircle,{title:e.image.shapeCircle,event:"imageClass",value:"img-circle"}),k=c(g.iconPrefix+g.icons.image.shapeThumbnail,{title:e.image.shapeThumbnail,event:"imageClass",value:"img-thumbnail"}),l=c(g.iconPrefix+g.icons.image.bordered,{title:e.image.bordered,event:"imageClass",value:"img-bordered"}),m=c(g.iconPrefix+g.icons.image.shapeNone,{title:e.image.shapeNone,event:"imageShape",value:""}),n=c(g.iconPrefix+g.icons.image.remove,{title:e.image.remove,event:"removeMedia",value:"none"}),o='<div class="btn-group">'+a+f+h+'</div><div class="btn-group">'+i+j+k+l+m+'</div><div class="btn-group">'+n+"</div>";return d("note-image-popover",o)},j=function(){for(var b=a("<div />"),c=0,h=g.airPopover.length;c<h;c++){for(var i=g.airPopover[c],j=a('<div class="note-'+i[0]+' btn-group">'),k=0,l=i[1].length;k<l;k++){var m=a(f[i[1][k]](e,g));m.attr("data-name",i[1][k]),j.append(m)}b.append(j)}return d("note-air-popover",b.children())},k=a('<div class="note-popover" />');return k.append(h()),k.append(i()),g.airMode&&k.append(j()),k},j=function(){return'<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-sizing note-control-se"></div><div class="note-control-selection-info"></div></div></div>'},k=function(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&c.push("<tr><td>"+b[d].kbd+"</td><td>"+b[d].text+"</td></tr>");return"<thead><tr><th>"+a+"</th><th>(keys)</th></tr></thead><tbody>"+c.join("")+"</tbody>"},l=function(a){var b=[{kbd:"⌘ + B",text:a.font.bold},{kbd:"⌘ + I",text:a.font.italic},{kbd:"⌘ + U",text:a.font.underline},{kbd:"⌘ + \\",text:a.font.clear}];return k(a.shortcut.textFormatting,b)},n=function(a){var b=[{kbd:"⌘ + Z",text:a.history.undo},{kbd:"⌘ + ⇧ + Z",text:a.history.redo},{kbd:"⌘ + ]",text:a.paragraph.indent},{kbd:"⌘ + [",text:a.paragraph.outdent},{kbd:"⌘ + ENTER",text:a.hr.insert}];return k(a.shortcut.action,b)},o=function(a){var b=[{kbd:"⌘ + ⇧ + L",text:a.paragraph.left},{kbd:"⌘ + ⇧ + E",text:a.paragraph.center},{kbd:"⌘ + ⇧ + R",text:a.paragraph.right},{kbd:"⌘ + ⇧ + J",text:a.paragraph.justify},{kbd:"⌘ + ⇧ + NUM7",text:a.lists.ordered},{kbd:"⌘ + ⇧ + NUM8",text:a.lists.unordered}];return k(a.shortcut.paragraphFormatting,b)},p=function(a){var b=[{kbd:"⌘ + NUM0",text:a.style.normal},{kbd:"⌘ + NUM1",text:a.style.h1},{kbd:"⌘ + NUM2",text:a.style.h2},{kbd:"⌘ + NUM3",text:a.style.h3},{kbd:"⌘ + NUM4",text:a.style.h4},{kbd:"⌘ + NUM5",text:a.style.h5},{kbd:"⌘ + NUM6",text:a.style.h6}];return k(a.shortcut.documentStyle,b)},q=function(a,b){var c=['<table class="striped hoverable">'+n(a,b)+"</table>",'<table class="striped hoverable">'+p(a,b)+"</table>",'<table class="striped hoverable">'+l(a,b)+"</table>",'<table class="striped hoverable">'+o(a,b)+"</table>"].join("<br>");return b.extraKeys,c},r=function(a){return a.replace(/⌘/g,"Ctrl").replace(/⇧/g,"Shift")},s={image:function(a,b){var c="";if(b.maximumImageFileSize){var d=Math.floor(Math.log(b.maximumImageFileSize)/Math.log(1024)),f=1*(b.maximumImageFileSize/Math.pow(1024,d)).toFixed(2)+" "+" KMGTP"[d]+"B";c="<small>"+a.image.maximumFileSize+" : "+f+"</small>"}var g='<div class="row"><div class="col s12"><div class="file-field input-field"><div class="btn"><span>'+a.image.image+'</span><input class="note-image-input" name="files" type="file" /></div><div class="file-path-wrapper"><input class="file-path" type="text" /></div></div></div></div><div class="row"><div class="input-field col s12"><input class="note-image-url" type="text" /><label>'+a.image.url+"</label></div></div>",h='<button href="#" class="waves-effect waves-light btn note-image-btn disabled" disabled>'+a.image.insert+'</button><button class="waves-effect waves-light btn btnClose">'+a.shortcut.close+"</button>";return e("note-image-dialog",a.image.insert,g,h)},link:function(a,b){var c='<div class="row"><div class="input-field col s12"><input class="note-link-text" type="text" /><label>'+a.link.textToDisplay+'</label></div></div><div class="row"><div class="input-field col s12"><input class="note-link-url" type="text" value="http://" /><label class="active">'+a.link.url+"</label></div></div>"+(b.disableLinkTarget?"":'<div class="row"><div class="col s12"><input type="checkbox" id="'+materialUniqueId+'-noteInsertLinkNewWindow" checked="checked" /><label for="'+materialUniqueId+'-noteInsertLinkNewWindow">'+a.link.openInNewWindow+"</label></div></div>"),d='<button href="#" class="waves-effect waves-light btn note-link-btn disabled" disabled>'+a.link.insert+'</button><button class="waves-effect waves-light btn btnClose">'+a.shortcut.close+"</button>";return e("note-link-dialog",a.link.insert,c,d)},help:function(a,b){var c=h.isMac?q(a,b):r(q(a,b)),d='<button href="#" class="waves-effect waves-light btn modal-close">'+a.shortcut.close+"</button>";return e("note-help-dialog",a.shortcut.shortcuts,c,d)}},t=function(b,c){var d="";return a.each(s,function(a,e){d+=e(b,c)}),'<div class="note-dialog">'+d+"</div>"},u=function(){return'<div class="note-resizebar"><div class="note-icon-bar"></div><div class="note-icon-bar"></div><div class="note-icon-bar"></div></div>'},v=function(a){return h.isMac&&(a=a.replace("CMD","⌘").replace("SHIFT","⇧")),a.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]")},w=function(b,c,d){a(document).ready(function(){var d=i.invertObject(c),e=b.find(".btn");e.each(function(b,c){var e=a(c),f=d[e.data("event")],g=e.attr("title");f&&e.attr("data-tooltip",function(b,c){return g=g+" ("+v(f)+")",a(this).removeAttr("title"),g}),e.attr("data-position","bottom"),e.attr("data-tooltip",g),e.removeAttr("title")}).tooltip({container:b,position:"top",delay:30})})},x=function(b,c){var d=c.colors,e=c.colorTitles;b.find(".note-color-palette").each(function(){for(var b=a(this),c=b.attr("data-target-event"),f=[],g=0,h=d.length;g<h;g++){for(var i=d[g],j=e[g],k=[],l=0,m=i.length;l<m;l++){var n=i[l],o=j[l];k.push(['<button type="button" class="note-color-btn" style="background-color:',n,';" data-event="',c,'" data-value="',n,'" data-description="',o,'" data-toggle="button" tabindex="-1"></button>'].join(""))}f.push('<div class="note-color-row">'+k.join("")+"</div>")}b.html(f.join("")),b.find("button").mouseenter(function(){b.siblings(".colorName").html(a(this).data("description"))}),b.mouseleave(function(){a(this).siblings(".colorName").html("")})})};this.createLayoutByAirMode=function(b,c){var d=c.langInfo,e=c.keyMap[h.isMac?"mac":"pc"],f=i.uniqueId();b.addClass("note-air-editor note-editable"),b.attr({id:"note-editor-"+f,contentEditable:!0});var k=document.body,l=a(g(d,c));l.addClass("note-air-layout"),l.attr("id","note-popover-"+f),l.appendTo(k),w(l,e),x(l,c);var m=a(j());m.addClass("note-air-layout"),m.attr("id","note-handle-"+f),m.appendTo(k);var n=a(t(d,c));n.addClass("note-air-layout"),n.attr("id","note-dialog-"+f),n.find("button.close, a.modal-close").click(function(){a(this).closest(".modal").closeModal()}),n.appendTo(k)},this.createLayoutByFrame=function(b,c){function d(){a(window).scroll(function(){var b=i.hasClass("fullscreen");if(b)return!1;var d,e,f,g,h,j,k,l,m,n=i.children(".note-toolbar"),o=(n.outerHeight(),i.children(".note-editable")),p=o.outerHeight();i.width;m=a("."+c.otherStaticBarClass).outerHeight(),m||(m=0),k=a(document).scrollTop(),d=n.offset().top,e=i.offset().top,f=e+p,g=d-m,j=f-m,h=e-m,k>g&&k<j?(l=k-i.offset().top+m,n.css({top:l+"px","z-index":2e3})):k<d&&k<j&&(n.css({top:0,"z-index":1052}),k>h&&(l=k-i.offset().top+m,n.css({top:l+"px","z-index":2e3})))})}var e=c.langInfo,i=a('<div class="note-editor"></div>');c.width&&i.width(c.width),c.height>0&&a('<div class="note-statusbar">'+(c.disableResizeEditor?"":u())+"</div>").prependTo(i);var k=!b.is(":disabled"),l=a('<div class="note-editable" contentEditable="'+k+'"></div>').prependTo(i);c.height&&l.height(c.height),c.direction&&l.attr("dir",c.direction);var n=b.attr("placeholder")||c.placeholder;n&&l.attr("data-placeholder",n),l.html(m.html(b)),a('<textarea class="note-codable"></textarea>').prependTo(i);for(var o=a('<div class="note-toolbar btn-toolbar" />'),p=0,q=c.toolbar.length;p<q;p++){for(var r=c.toolbar[p][0],s=c.toolbar[p][1],v=a('<div class="note-'+r+' btn-group" />'),y=0,z=s.length;y<z;y++){var A=f[s[y]];if(a.isFunction(A)){var B=a(A(e,c));B.attr("data-name",s[y]),v.append(B)}}o.append(v)}o.prependTo(i);var C=c.keyMap[h.isMac?"mac":"pc"];x(o,c),w(o,C,"bottom"),c.followingToolbar&&d();var D=a(g(e,c)).prependTo(i);x(D,c),w(D,C),a(j()).prependTo(i);var E=a(t(e,c)).prependTo(i);E.find("button.close, a.modal-close").click(function(){a(this).closest(".modal").closeModal()}),a('<div class="note-dropzone"><div class="note-dropzone-message"></div></div>').prependTo(i),i.insertAfter(b),b.hide()},this.hasNoteEditor=function(a){return this.noteEditorFromHolder(a).length>0},this.noteEditorFromHolder=function(b){return b.hasClass("note-air-editor")?b:b.next().hasClass("note-editor")?b.next():a()},this.createLayout=function(a,b){b.airMode?this.createLayoutByAirMode(a,b):this.createLayoutByFrame(a,b)},this.layoutInfoFromHolder=function(a){var b=this.noteEditorFromHolder(a);if(b.length)return b.data("holder",a),m.buildLayoutInfo(b)},this.removeLayout=function(a,b,c){c.airMode?(a.removeClass("note-air-editor note-editable").removeAttr("id contentEditable"),b.popover().remove(),b.handle().remove(),b.dialog().remove()):(a.html(b.editable().html()),b.editor().remove(),a.show())},this.getTemplate=function(){return{button:b,iconButton:c,dialog:e}},this.addButtonInfo=function(a,b){f[a]=b},this.addDialogInfo=function(a,b){s[a]=b}};a.materialnote=a.materialnote||{},a.extend(a.materialnote,o);var N=new M,O=new L;a.extend(a.materialnote,{renderer:N,eventHandler:O,core:{agent:h,list:j,dom:m,range:n},pluginEvents:{},plugins:[]}),a.materialnote.addPlugin=function(b){a.materialnote.plugins.push(b),b.buttons&&a.each(b.buttons,function(a,b){N.addButtonInfo(a,b)}),b.dialogs&&a.each(b.dialogs,function(a,b){N.addDialogInfo(a,b)}),b.events&&a.each(b.events,function(b,c){a.materialnote.pluginEvents[b]=c}),b.langs&&a.each(b.langs,function(b,c){a.materialnote.lang[b]&&a.extend(a.materialnote.lang[b],c)}),b.options&&a.extend(a.materialnote.options,b.options)},a.fn.extend({materialnote:function(){var b=a.type(j.head(arguments)),c="string"===b,d="object"===b,e=d?j.head(arguments):{};if(e=a.extend({},a.materialnote.options,e),e.icons=a.extend({},a.materialnote.options.icons,e.icons),e.langInfo=a.extend(!0,{},a.materialnote.lang["en-US"],a.materialnote.lang[e.lang]),!c&&d)for(var f=0,g=a.materialnote.plugins.length;f<g;f++){var h=a.materialnote.plugins[f];e.plugin[h.name]&&(a.materialnote.plugins[f]=a.extend(!0,h,e.plugin[h.name]))}this.each(function(b,c){materialUniqueId=a(c).attr("id");var d=a(c);if(!N.hasNoteEditor(d)){N.createLayout(d,e);var f=N.layoutInfoFromHolder(d);d.data("layoutInfo",f),O.attach(f,e),O.attachCustomEvent(f,e)}});var i=this.first();if(i.length){var k=N.layoutInfoFromHolder(i);if(c){var l=j.head(j.from(arguments)),m=j.tail(j.from(arguments)),n=[l,k.editable()].concat(m);return O.invoke.apply(O,n)}e.focus&&k.editable().focus()}return a(this).each(function(b,c){function d(b,d){var f=a(b).next("ul.dropdown-menu");a(b).parent(".btn-group");f.slideUp(0),a(".preventDropClose").click(function(a){a.stopPropagation()}),a(b).click(function(e){var i=Math.round(a(b).parent(".btn-group").offset().left-g.offset().left),j=parseInt(f.css("border-left-width")),k=c.outerWidth(),l=j;f.css({"max-width":k+"px"});var m=f.outerWidth(),n=m+i;n>=k&&(l=n-k,h||(l+=j)),f.css({left:"-"+l+"px"});var o=!0;f.is(":visible")&&(o=!1),d.find("ul.dropdown-menu").slideUp(200),o&&f.slideToggle(200),e.stopPropagation()}),e.unbind().click(function(a){j=!1})}var e,f,g,h=!1;if(a(c).hasClass("note-air-editor")){var i=a(this).attr("id");i&&(i=i.substring(i.lastIndexOf("-")+1,i.length)),c=a("#note-popover-"+i).find(".note-air-popover"),f=c.find("ul.tabs"),e=c.find("li.tab a"),g=a(c).find(".popover-content button.dropdown"),h=!0}else c=a(c).next(".note-editor"),f=c.find("ul.tabs"),e=c.find("li.tab a"),g=a(c).find(".note-toolbar button.dropdown");var j=!0;a(window).click(function(a){j&&c.find("ul.dropdown-menu").slideUp(200),j=!0,a.stopPropagation()}),g.each(function(a,b){d(b,c)}),f.tabs()}),this},code:function(b){if(void 0===b){var c=this.first();if(!c.length)return;var d=N.layoutInfoFromHolder(c),e=d&&d.editable();if(e&&e.length){var f=O.invoke("codeview.isActivated",d);return O.invoke("codeview.sync",d),f?d.codable().val():d.editable().html()}return m.value(c)}return this.each(function(c,d){var e=N.layoutInfoFromHolder(a(d)),f=e&&e.editable();f&&f.html(b)}),this},destroy:function(){return this.each(function(b,c){var d=a(c);if(N.hasNoteEditor(d)){var e=N.layoutInfoFromHolder(d),f=e.editor().data("options");O.detach(e,f),N.removeLayout(d,e,f)}}),this}})});